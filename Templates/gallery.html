{% extends 'base.html' %}
{% block title %}Gallery{% endblock %}

{% block extra_css %}
<style>
/* ðŸŒŸ Efek Glass untuk item gallery */
.gallery-item {
  position: relative;
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(12px);
  border-radius: 16px;
  overflow: hidden;
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: transform 0.4s ease, box-shadow 0.4s ease;
}
.gallery-item img,
.gallery-item video {
  border-radius: 16px;
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.5s ease;
}
.gallery-item:hover {
  transform: translateY(-6px) scale(1.02);
  box-shadow: 0 8px 25px rgba(0, 255, 255, 0.4),
              0 12px 40px rgba(255, 0, 255, 0.3);
}
.gallery-item:hover img,
.gallery-item:hover video {
  transform: scale(1.05);
}

/* ðŸŒŸ Shine effect */
.gallery-item::after {
  content: "";
  position: absolute;
  top: 0;
  left: -75%;
  width: 50%;
  height: 100%;
  background: linear-gradient(
    120deg,
    rgba(255,255,255,0.6) 0%,
    rgba(255,255,255,0) 80%
  );
  transform: skewX(-25deg);
  animation: shine 7s infinite;
  pointer-events: none;
}
@keyframes shine {
  0% { left: -75%; }
  50% { left: 125%; }
  100% { left: 125%; }
}

/* ðŸŒŸ Modal efek kaca */
.modal-content {
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(15px);
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.2);
}

/* ðŸŒŸ Judul Gallery */
#galleryTitle {
  font-weight: 700;
  color: #ffffff;
  text-shadow: 0 0 10px rgba(0,255,255,0.7),
               0 0 20px rgba(255,0,255,0.5);
}

/* ðŸŒŸ Label form upload */
.form-label {
  color: rgba(255,255,255,0.75);
}

/* ðŸŒŸ Tombol Upload */
.btn-primary {
  background: linear-gradient(90deg, #00ffff, #ff00ff);
  border: none;
  font-weight: 600;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.btn-primary:hover {
  transform: scale(1.05);
  box-shadow: 0 8px 20px rgba(0,255,255,0.4),
              0 8px 20px rgba(255,0,255,0.3);
}
</style>
{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- Header dengan filter -->
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
    <div>
      <h2 class="fw-bold" id="galleryTitle">Photos</h2>
    </div>

    <!-- Filter navbar -->
    <ul class="nav nav-pills mt-3 mt-md-0">
      <li class="nav-item">
        <a href="#" class="nav-link active" data-filter="photos">Photos</a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" data-filter="videos">Videos</a>
      </li>
    </ul>
  </div>

  <!-- Form Upload -->
  <div class="card shadow-sm border-0 rounded-3 mb-4">
    <div class="card-body">
      <h5 class="fw-bold mb-3">
        <i class="bi bi-cloud-arrow-up-fill text-info me-2"></i> Upload Media
      </h5>
      <form action="{{ url_for('upload') }}" method="post" enctype="multipart/form-data">
        <div class="mb-3">
          <label for="fileUpload" class="form-label text-muted">Choose photo or video</label>
          <input type="file" id="fileUpload" name="file" 
                 class="form-control" 
                 accept=".jpg,.jpeg,.png,.gif,.mp4,.webm,.avi" required>
        </div>
        <button class="btn btn-primary w-100" type="submit">
          <i class="bi bi-upload me-1"></i> Upload
        </button>
      </form>
    </div>
  </div>

  <!-- Gallery Sections -->
  <div id="galleryContent">

    <!-- Photos Section -->
    <div class="row g-3 gallery-section" id="photosSection">
      {% for img in images %}
      <div class="col-6 col-md-3">
        <div class="gallery-item">
          <img src="{{ url_for('static', filename='image/' ~ img) }}" 
               class="open-modal"
               data-bs-toggle="modal" 
               data-bs-target="#imageModal{{ loop.index }}"
               alt="{{ img }}">
        </div>
      </div>

      <!-- Modal untuk setiap foto -->
      <div class="modal fade" id="imageModal{{ loop.index }}" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content border-0">
            <img src="{{ url_for('static', filename='image/' ~ img) }}" 
                 class="w-100 rounded-4 shadow-lg" 
                 alt="{{ img }}">
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Videos Section -->
    <div class="row g-3 gallery-section d-none" id="videosSection">
      {% if videos %}
        {% for vid in videos %}
        <div class="col-6 col-md-3">
          <div class="gallery-item">
            <video preload="metadata" controls
                   data-bs-toggle="modal" 
                   data-bs-target="#videoModal{{ loop.index }}">
              <source src="{{ url_for('static', filename='video/' ~ vid) }}" type="video/mp4">
              Browser kamu tidak mendukung video tag.
            </video>
          </div>
        </div>

        <!-- Modal untuk setiap video -->
        <div class="modal fade" id="videoModal{{ loop.index }}" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0">
              <video controls class="w-100 rounded-4 shadow-lg">
                <source src="{{ url_for('static', filename='video/' ~ vid) }}" type="video/mp4">
              </video>
            </div>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div class="col-12 text-center text-muted">No videos yet.</div>
      {% endif %}
    </div>

  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // ===== Gallery filter =====
  const filterLinks = document.querySelectorAll('.nav-pills .nav-link');
  filterLinks.forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();
      filterLinks.forEach(l => l.classList.remove('active'));
      link.classList.add('active');
      const sections = document.querySelectorAll('.gallery-section');
      sections.forEach(sec => sec.classList.add('d-none'));
      const target = link.getAttribute('data-filter') + 'Section';
      document.getElementById(target).classList.remove('d-none');
      document.getElementById('galleryTitle').innerText = link.innerText;
    });
  });

  // ===== Pause video saat modal ditutup =====
  const modals = document.querySelectorAll('.modal');
  modals.forEach(modal => {
    modal.addEventListener('hidden.bs.modal', () => {
      const video = modal.querySelector('video');
      if (video) {
        video.pause();
        video.currentTime = 0;
      }
    });
  });
</script>
{% endblock %}